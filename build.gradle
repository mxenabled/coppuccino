plugins {
    id 'java-gradle-plugin'
    id 'java'
    id 'groovy'
    id 'maven-publish'
    id 'maven'
    id "com.jfrog.artifactory" version "4.15.1"
    id 'com.github.ben-manes.versions' version '0.27.0'
}

group 'com.mx.coppuccino'
version '0.0.19'

sourceCompatibility = 1.8

repositories {
    maven { url "https://artifactory.internal.mx:443/maven-local" }
    maven { url "https://artifactory.internal.mx:443/gradle-local" }
    jcenter()
    gradlePluginPortal()
    mavenLocal()
}

dependencies {
    implementation 'ru.vyarus:gradle-quality-plugin:4.1.0'
    implementation 'org.codehaus.groovy:groovy-all:2.5.8'
    implementation 'com.github.spotbugs:spotbugs-gradle-plugin:2.0.1'
    implementation 'org.codehaus.groovy:groovy-all:2.3.11'
    implementation 'com.diffplug.spotless:spotless-plugin-gradle:3.26.1'
    implementation 'io.gitlab.arturbosch.detekt:detekt-gradle-plugin:1.7.4'
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

project.description     = 'Java style, standard, and safety enforcement'
project.group           = 'com.mx.coppuccino'
project.version         = '0.0.19'

project.ext.name        = 'coppuccino'
project.ext.pluginId    = 'com.mx.coppuccino'
project.ext.scm         = 'scm:git@gitlab.mx.com:mx/coppuccino.git'
project.ext.url         = 'https://gitlab.mx.com/mx/coppuccino'

gradlePlugin {
    plugins {
        coppuccinoPlugin {
            id = project.pluginId
            implementationClass = 'com.mx.coppuccino.CoppuccinoPlugin'
        }
    }
}

artifactory {
    contextUrl = "https://artifactory.internal.mx:443"
    publish {
        repository {
            repoKey = 'gradle-local'
            username = "gradle-write"
            password = System.getenv("GRADLE_ARTIFACTORY_API_KEY")
            maven = true
        }
        defaults {
            publishConfigs('archives')
            publishBuildInfo = false
            publishPom = false
            publishIvy = false
            invokeMethod("publications", publishing.publications.names.toArray())
        }
    }
    resolve {
        repository {
            repoKey = 'maven-local'
            username = "maven-read"
            maven = true
        }
    }
}

artifactoryPublish {
    contextUrl = "https://artifactory.internal.mx:443"
    dependsOn jar
}
